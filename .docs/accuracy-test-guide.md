# 트리밍 정확도 테스트 가이드

이 가이드는 Video Trimmer의 트리밍 정확도를 검증하는 방법을 설명합니다.

## 사전 준비

### 1. 테스트용 비디오 파일 준비
다음 중 하나를 선택:

**옵션 A: 기존 비디오 사용**
- 3분 이상의 비디오 파일
- MP4 포맷 권장 (H.264 코덱)
- 500MB 이하 권장

**옵션 B: 샘플 비디오 다운로드**
- [Big Buck Bunny](https://download.blender.org/demo/movies/BBB/) - 무료 테스트 비디오
- [Sample Videos](https://sample-videos.com/) - 다양한 샘플

### 2. 키프레임 정보 확인 (선택사항)
비디오의 키프레임 간격을 알면 결과 해석에 도움이 됩니다.

```bash
# FFmpeg/FFprobe가 설치되어 있다면
ffprobe -select_streams v -show_frames input.mp4 | grep -E "pict_type=I|pkt_pts_time" | head -20
```

---

## 테스트 방법

### 방법 1: 앱 UI를 통한 수동 테스트 (권장)

#### 단계별 진행

**1단계: 개발 서버 실행**
```bash
npm run dev
```

**2단계: 브라우저 개발자 도구 열기**
- Chrome: `F12` 또는 `Cmd+Option+I` (Mac)
- Console 탭으로 이동

**3단계: 테스트 케이스 확인**
콘솔에서:
```javascript
accuracyTest.listTestCases()
```

다음과 같은 테스트 케이스가 표시됩니다:
```
┌─────────┬──────────────────────────┬───────────┬─────────┬──────────────────┐
│ (index) │           name           │ startTime │ endTime │ expectedDuration │
├─────────┼──────────────────────────┼───────────┼─────────┼──────────────────┤
│    0    │   '짧은 구간 (2-5초)'    │    2.0    │   5.0   │       3.0        │
│    1    │  '중간 구간 (30-45초)'   │   30.0    │  45.0   │      15.0        │
│    2    │ '긴 구간 (120-180초)'    │  120.0    │ 180.0   │      60.0        │
│    3    │ '소수점 정밀도 (...)'    │   2.345   │ 5.678   │      3.333       │
│    4    │ '매우 짧은 구간 (...)'   │    0.5    │  1.5    │       1.0        │
└─────────┴──────────────────────────┴───────────┴─────────┴──────────────────┘
```

**4단계: 각 테스트 케이스 실행**

각 테스트 케이스마다:

1. 비디오 업로드
2. 테스트 케이스의 `startTime`과 `endTime`으로 트림 포인트 설정
   - 예: 테스트 0 → 2.0초 ~ 5.0초
3. Export 버튼 클릭
4. 다운로드된 비디오 파일 확인

**5단계: 결과 측정**

**방법 A: 브라우저에서 측정**
1. 다운로드된 파일을 브라우저로 드래그
2. 개발자 도구 Console에서:
   ```javascript
   accuracyTest.getVideoDuration()
   ```
3. 표시된 duration을 기록

**방법 B: FFprobe 사용 (더 정확)**
```bash
ffprobe -v error -show_entries format=duration -of default=noprint_wrappers=1:nokey=1 output.mp4
```

**6단계: 결과 기록**

콘솔에서:
```javascript
// 예: 테스트 케이스 0, 실제 duration 3.123초
accuracyTest.recordResult(0, 3.123)
```

출력 예:
```
📊 짧은 구간 (2-5초)
  예상 duration: 3.000초
  실제 duration: 3.123초
  오차: +0.123초 (4.10%)
  ✅ 정확도: 매우 높음 (±0.1초 이내)
```

**7단계: 모든 테스트 완료 후**

결과 배열을 만들고 리포트 생성:
```javascript
const results = [
  // recordResult의 반환값들을 여기에 저장
];

accuracyTest.generateReport(results)
```

마크다운 표가 생성되어 `.docs/accuracy-test.md`에 복사할 수 있습니다.

---

### 방법 2: 자동화된 테스트 (추후 구현)

현재는 수동 테스트만 지원합니다. 자동화 테스트는 다음을 포함할 예정:
- E2E 테스트 스크립트
- 자동 duration 측정
- 자동 리포트 생성

---

## 테스트 결과 기록 양식

`.docs/accuracy-test.md` 파일에 다음 형식으로 기록:

```markdown
## Phase 0.1: 현재 정확도 측정

### 테스트 환경
- **날짜**: YYYY-MM-DD
- **브라우저**: Chrome 120 (또는 사용 브라우저)
- **FFmpeg 버전**: @ffmpeg/ffmpeg@0.12.10
- **테스트 파일**: sample.mp4 (H.264, 1080p, 30fps)
- **키프레임 간격**: 2초

### 테스트 결과

| 테스트 케이스 | 예상 (초) | 실제 (초) | 오차 (초) | 오차 (%) |
|-------------|----------|----------|----------|----------|
| 짧은 구간 (2-5초) | 3.000 | 3.123 | +0.123 | 4.10% |
| ... | ... | ... | ... | ... |

### 요약
- 평균 오차: ±0.XXX초
- 최대 오차: ±0.XXX초
- 테스트 개수: 5개

### 결론
- [ ] 오차 발생 여부: YES/NO
- [ ] 평균 오차가 허용 범위 내 (±0.5초): YES/NO
- [ ] Phase 0.2 진행 필요: YES/NO
```

---

## 주의사항

1. **일관된 환경**: 모든 테스트를 같은 브라우저, 같은 비디오 파일로 진행
2. **duration 정밀도**: 브라우저의 `video.duration`은 소수점 이하 제한이 있을 수 있음
3. **키프레임 간격**: 비디오의 키프레임 간격이 결과에 영향을 줄 수 있음
4. **비디오 길이**: 테스트 케이스의 최대 시간(180초)보다 긴 비디오 사용

---

## 다음 단계

### 오차가 허용 범위 내인 경우 (±0.5초 이하)
→ Phase 0.2-0.3 생략, 문서만 업데이트

### 오차가 발생한 경우
→ Phase 0.2: 오차 원인 분석 진행

1. 시간 전달 정밀도 확인
2. 키프레임 간격 분석
3. FFmpeg 옵션 검토

### 심각한 오차인 경우 (±2초 이상)
→ Phase 0.3: 개선 방법 시도

1. `-ss` 위치 변경 테스트
2. `-accurate_seek` 옵션 테스트
3. 기타 FFmpeg 옵션 실험

---

## 도움말

### 문제: 테스트 유틸리티가 콘솔에 없음
→ 개발 모드에서 실행 중인지 확인: `npm run dev`

### 문제: 비디오 duration이 부정확함
→ FFprobe를 사용하여 더 정확하게 측정

### 문제: 특정 테스트 케이스가 실패함
→ 비디오 길이가 테스트 케이스의 endTime보다 긴지 확인

---

_작성일: 2026-01-28_
_작성자: Claude Code_
